# ==== ENDER 3 COORDINATE SYSTEM AND MEASUREMENTS ====
# 
# This is the specific Ender 3 Pro we have and its parameters:
#
# 	- the bed moves for the y axis (XZ gantry)
# 	- at (0,0) the bed is all the way towards the rear of the printer and the
# 		print head is at the extreme left
# 	- printable bed size is 220x220
# 	- actual bed size is 235x235
# 	- in X, the bed is centered on the frame coordinate system
#
# 	We'll use the X/Y parts of the Fusion 360 model's coordinate system as the
# 	X/Y for the base printer coordinate system, so (0, 0) is centered above one
# 	of the bolts on the bottom of the printer. Note that in Fusion the model is
# 	oriented with Y up and Z towards the front of the printer, but I'm switching
# 	coordinates here so that Z is up and Y is towards the back.
#
# 	Looking straight down from the top of the printer, x=0 is at the center of
# 	the top cross-piece of the printer, and y=0 is at the top/back edge of that
# 	piece. We'll set z=0 as the bed surface (in the Fusion model this is at
# 	z=100.964 mm above the table surface, but in real life is at 100 mm).
#
# 	By this coordinate system then (verified by measuring):
# 		* Actual bed  (0,0,0) = (-117.5, -65, 0)
# 		* Ring (0,0)   = (-5.5, 74.2)
# 		* Ring x center is 122 mm from bed x = 0
#
# Ring configuration:
# 	- ring is fixed to the x-axis gantry
# 	- ring y center (nearly) matches the center of the x-axis gantry bar, which
# 		is 1 in towards the rear from the center of the nozzle
# 	- ring x center is 129.5 mm from left z-axis gantry, or 122 mm from bed x = 0
#
# Bed configuration:
# 	Effective size is 110 x 220. On the actual printer, the effective width as
# 	measured by moving the head and seeing where the nozzle hits the bed is 110
# 	mm, with the left side of this area at 65 mm from the left edge of the bed.
#
# 	Thus, the new origin for the bed, in the printer frame coordinate system, is
# 	then (-52.5, -65, 0) (x=235/2 - 65 = 52.5). This is when the bed is at y=0,
# 	with the front edge of the bed plate underneath the nozzle. When the bed is
# 	at its other extreme, with the back edge of the plate under the nozzle, then
# 	the actual front-left corner of the bed is at (-52.5, -285).
#
# The conceptual model for the coordinate system is that the bed is fixed, with
# the effective (0, 0) coordinate as actual (0, 0). Then the print head moves as
# expected in two dimensions, and the ring is locked in position relative to the
# head, so it moves in 2D as well. This inversion of the actual situation should
# be more intuitive and require less converting of coordinate systems.
#
# ==== YAML CONFIGURATION ====
#
# Yaml allows you to reuse parts of the configuration by naming a section to re-use
# later. The name is marked with "&" (e.g, "&my_stuff") and the re-use with "<<: *"
# (e.g., "<<: *my_stuff"). So doing this:
#
# stuff: &my_stuff
#   things: 11
#   other_things: 35
# more_stuff:
#   <<: *my_stuff
#   other_things: 99
#   zoop: 4
#
# yields this when processed (the parts under "stuff" are copied to "more_stuff" but
# then overwritten if a new value is given):
#
# {
#   'stuff': {
#     'things': 11,
#     'other_things': 35
#   },
#   'more_stuff': {
#     'things': 11,
#     'other_things': 99,
#     'zoop': 4
#   }
# }

general:
  #The angle, in degrees, that the thread should be set to on startup. Note:
  # this is *not* the ring angle, but the thread's angle out of the anchor.
  initial_thread_angle: 90

  #Options for when the print head crosses the thread in different situations
  head_crosses_thread:
    defaults: &head_crosses_thread_defaults
      #How far to raise the head when it will cross the thread
      head_raise: 0.4
      head_raise_speed: 200

      #The ideal length of the head move as it crosses the thread; this will
      # center the thread in this move. If the segment is shorter than this,
      # the entire segment will be raised. If 0 or missing the head won't
      # be raised.
      overlap_length: 2

    #For explicit anchor-fixing moves, where the thread will be rotating with
    # the anchor as the pivot point
    anchor_fixing:
      <<: *head_crosses_thread_defaults
      move_feedrate: 700
      extrude_multiply: 1.2
      post_pause: 0.2

    #For moves where filament will be extruded over the thread, but not as an anchor
    extruding:
      <<: *head_crosses_thread_defaults

    #Any time the head crosses the thread while *not* extruding
    non_extruding:
      <<: *head_crosses_thread_defaults

ring:
  #16 microsteps, 200 steps per rotation = 3200
  #Used to know the minimum angle we can move for nicer gcode
  stepper_microsteps_per_rotation: 3200

  #Configure gears
  motor_gear_teeth: 19
  ring_gear_teeth : 112

  #The center of the ring in printer frame coordinates, in mm
  center: [-10.1, -74.2, 0]

  #Ring radius, measured from center to thread outlet in thread carrier, in mm
  radius: 93

  #Home angle of ring, in degrees
  home_angle: 90

  #How fast to move the ring?
  feedrate: 5000

  #Avoid ring/head collisions in the configuration where the thread carrier is
  # mounted internal to the ring
  collision_avoid:
    - head_between: [0, 25]
      ring_between: [145, 185]
      move_ring_to: 185
    - head_between: [95, 200]
      ring_between: [0, 45]
      move_ring_to: 45
    - head_between: [95, 200]
      ring_between: [340, 360]
      move_ring_to: 340


bed:
  #By printer-frame coordinates, the actual bed (0,0,0) = (-117.5, -65, 0)
  #Note: the "effective" bed is the portion of the physical print bed which is
  # actually printable, taking the ring into account.

  #The "zero" point of the effective bed in mm, in printer frame coordinates
  zero: [-41.35, -65, 0]

  #The size of the effective bed in mm
  size: [106, 220]

  #The point where the thread is anchored to the bed, in mm, in printer frame
  # coordinates
  #(Here it's Xmm from the actual bed's left edge and Ymm from the front)3.45 , -1.2 
  anchor: [-114.05, -66.2, 0]
